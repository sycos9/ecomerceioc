<!DOCTYPE html>
<html lang="ca" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>E-random-Comerç | Botiga</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
    />
  </head>
  <body>
    <!-- Barra de navegació -->
    <header class="navbar">
      <div class="logo">E-random-Comerç</div>
      <nav class="nav-links">
        <a th:href="@{/Random}">Inici</a>
        <a th:href="@{/Random/productos}">Productes</a>
        <a href="#">Blog</a>
      </nav>
      <div class="nav-icons">
        <form th:action="@{/Random}" method="get" class="d-flex align-items-center" style="gap: 5px;">
          <input type="text" 
                 name="busqueda" 
                 placeholder="Cercar..." 
                 class="search-bar" 
                 th:value="${busqueda}" />
          <input type="hidden" name="categoria" th:value="${categoriaSeleccionada}" />
          <button type="submit" class="icon" style="border: none; background: none; cursor: pointer;">
            <i class="fa-solid fa-magnifying-glass"></i>
          </button>
        </form>
        <a th:href="@{/carret}" class="icon">
            <i class="fa-solid fa-cart-shopping"></i>
        </a>
        <a th:href="@{/registre}" class="icon">
            <i class="fa-solid fa-user"></i>
        </a>
      </div>
    </header>

    <!-- Contingut principal -->
    <main class="main-content">
      <!-- Barra lateral -->
      <aside class="sidebar">
        <h3>Categories</h3>
        <ul>
          <li>
            <a th:href="@{/Random(busqueda=${busqueda})}" 
               th:class="${categoriaSeleccionada == null} ? 'active' : ''">
              Tots els productes
            </a>
          </li>
          <li th:each="cat : ${categorias}">
            <a th:href="@{/Random(categoria=${cat}, busqueda=${busqueda})}" 
               th:text="${cat}"
               th:class="${categoriaSeleccionada == cat} ? 'active' : ''">
              Categoria
            </a>
          </li>
        </ul>
      </aside>

      <!-- Llista de productes -->
      <section class="product-section">
        <h2 class="section-title">
          <span th:if="${busqueda != null and !busqueda.isEmpty()}">
            Resultats de la cerca: "<span th:text="${busqueda}"></span>"
            <span th:if="${categoriaSeleccionada != null}"> en <span th:text="${categoriaSeleccionada}"></span></span>
          </span>
          <span th:if="${busqueda == null or busqueda.isEmpty()}">
            <span th:text="${categoriaSeleccionada != null} ? 'Productes: ' + ${categoriaSeleccionada} : 'Productes destacats'">Productes destacats</span>
          </span>
        </h2>

        <div class="container mt-4">
          <div class="row g-4">
            <!-- Si hay productos, los muestra -->
            <div th:each="producto : ${productos}" class="col-md-6">
              <div class="card h-100 shadow-sm">
                <!-- Imagen del producto (clicable) -->
                <a th:href="@{/Random/productos/{id}(id=${producto.id}, categoria=${categoriaSeleccionada}, busqueda=${busqueda})}" style="text-decoration: none; color: inherit;">
                  <div class="card-img-top-container" style="height: 300px; overflow: hidden; background-color: #f8f9fa; display: flex; align-items: center; justify-content: center; cursor: pointer;">
                    <img th:if="${producto.imagen != null and !producto.imagen.isEmpty()}" 
                         th:src="@{/Random/imagenes/{nombre}(nombre=${producto.imagen})}" 
                         th:alt="${producto.nombre}" 
                         class="card-img-top" 
                         style="width: 100%; height: 100%; object-fit: cover;">
                    <span th:if="${producto.imagen == null or producto.imagen.isEmpty()}" 
                          class="text-muted">
                      <i class="fa-solid fa-image fa-4x"></i>
                    </span>
                  </div>
                </a>
                
                <div class="card-body d-flex flex-column">
                  <!-- Código, Nombre y precio -->
                  <div class="d-flex justify-content-between align-items-start mb-2">
                    <div class="d-flex align-items-center">
                      <a th:href="@{/Random/productos/{id}(id=${producto.id}, categoria=${categoriaSeleccionada}, busqueda=${busqueda})}" style="text-decoration: none; color: inherit;">
                        <span class="text-muted small me-2" th:text="${producto.codigo}">COD</span>
                      </a>
                      <a th:href="@{/Random/productos/{id}(id=${producto.id}, categoria=${categoriaSeleccionada}, busqueda=${busqueda})}" style="text-decoration: none; color: inherit;">
                        <h5 class="card-title mb-0" th:text="${producto.nombre}">Nom del producte</h5>
                      </a>
                    </div>
                    <span class="text-primary fw-bold fs-5 ms-3" th:text="${'€' + #numbers.formatDecimal(producto.precio, 1, 2)}">€0.00</span>
                  </div>
                  
                  <!-- Categoría -->
                  <div class="mb-3">
                    <span class="badge bg-secondary" th:text="${producto.categoria}">Categoria</span>
                  </div>
                  
                  <!-- Botón añadir al carro -->
                  <button class="btn btn-primary mt-auto" 
                          th:data-producto-id="${producto.id}"
                          onclick="añadirAlCarro(this.dataset.productoId)">
                    <i class="fa-solid fa-cart-plus"></i> Afegeix al carro
                  </button>
                </div>
              </div>
            </div>

            <!-- Si no hay productos -->
            <div th:if="${productos == null or productos.isEmpty()}" class="col-12">
              <div class="text-center text-muted py-5">
                <i class="fa-solid fa-box-open fa-3x mb-3"></i>
                <p>No hi ha productes disponibles</p>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- Secció informació -->
    <section class="info-section">
      <h2>Preparat per descobrir nous productes?</h2>
      <p>Subscriu-te per rebre les últimes novetats i ofertes exclusives.</p>
      <div class="newsletter">
        <input type="email" placeholder="El teu correu" />
        <button>Enviar</button>
      </div>
    </section>

    <!-- Peu de pàgina -->
    <footer class="footer">
      <div class="footer-links">
        <div>
          <h4>Sobre nosaltres</h4>
          <a href="#">Blog</a>
          <a href="#">Equip</a>
        </div>
        <div>
          <h4>Ajuda</h4>
          <a href="#">Contacte</a>
          <a href="#">Enviaments</a>
          <a href="#">Retorns</a>
        </div>
      </div>
      <p class="copyright">© 2025 E-random-Comerç. Tots els drets reservats.</p>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Función para añadir al carro (placeholder) -->
    <script>
      function añadirAlCarro(productoId) {
        // TODO: Implementar lógica del carro de compras
        alert('Producte amb ID ' + productoId + ' afegit al carro');
      }
    </script>
  </body>
</html>

